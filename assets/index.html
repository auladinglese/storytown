<div id="main"></div>
<script src="main.js"></script>
<script>
    var app = Elm.Main.fullscreen();

    let mediaOptions = {
          video: {
            tag: 'video',
            type: 'video/webm',
            ext: '.mp4',
            gUM: {video: true, audio: true}
          },
          audio: {
            tag: 'audio',
            type: 'audio/ogg',
            ext: '.ogg',
            gUM: {audio: true}
          }
        };
    media = mediaOptions.audio;
    navigator.mediaDevices.getUserMedia(media.gUM).then(_stream => {
      stream = _stream;
      recorder = new MediaRecorder(stream);
      recorder.ondataavailable = e => {
        chunks.push(e.data);
        if(recorder.state == 'inactive') {
          app.ports.fileURL.send(makeLink());
        }
      };
      console.log('got media successfully');
    }).catch(console.log);

    app.ports.start.subscribe(e => {
      chunks=[];
      recorder.start();
      console.log("starting recorder")
    })

    app.ports.stop.subscribe(e => {
      recorder.stop();
      console.log("stopping recorder")
    })

    function makeLink(){
      let blob = new Blob(chunks, {type: media.type })
        , url = URL.createObjectURL(blob)
      ;
      return url;
    }
</script>
